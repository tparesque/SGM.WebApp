var pages = pages || {};
pages.menu = pages.menu || {};

pages.menu.model = function () {

    var vmUsuarioLogado = function (usuarioLogado) {
        var self = this;

        self.id = ko.observable(usuarioLogado.id);
        self.nome = ko.observable(usuarioLogado.nome);
        self.email = ko.observable(usuarioLogado.email);
        self.perfil = ko.observable(usuarioLogado.role);
        self.isAdministrador = ko.observable(usuarioLogado.isAdministrador); 
        self.isGestor = ko.observable(usuarioLogado.role == "Gestor"); 
        self.isUsuario = ko.observable(usuarioLogado.role == "Usuario"); 
    };

    return {       
        vmUsuarioLogado
    };
}();
var pages = pages || {};
pages.menu = pages.menu || {};

pages.menu.services = function () {  

    var EPerfil = {
        ADMINISTRADOR: "Administrador",
        GESTOR: "Gestor",
        USUARIO: "Usuario",
        FUNCIONARIO: "FuncionÃ¡rio"
    };

    var logoff = function () {
        var url = pages.metadata.actionUrlWeb("/logoff");
        return pages.dataServices.get(url);
    }  

    return {
        EPerfil,       
        logoff
    };
}();
var pages = pages || {};
pages.menu = pages.menu || {};
pages.menu.model = pages.menu.model || {};
pages.menu.services = pages.menu.services || {};

pages.metadata = pages.metadata || {};
pages.dataServices = pages.dataServices || {};
pages.utils = pages.utils || {};

pages.menu.viewModel = function () {   
    var model = pages.menu.model;
    var service = pages.menu.services;

    var viewModelMenu = new function () {
        var self = this;       
        
        self.usuarioLogado = ko.observable(new model.vmUsuarioLogado(getDataToken()));          

        self.redirecionarPerfil = function () {
            pages.dataServices.bloquearTela();
            window.location.href = "/Perfil/Index/" + self.usuarioLogado().id();
        };

        self.atualizarNome = function (nome) {
            atualizarNome(nome);
            self.usuarioLogado().nome(nome);
        };

        self.webLogoff = function () {
            service.logoff().then(() => {
                localStorage.removeItem("token");
                window.location.href = "/"; 
            });
        };

        self.obterUsuarioLogado = function () {            
            return self.usuarioLogado();
        };

        self.exibeMenuHome = ko.computed(function () {            
            if (self.usuarioLogado() &&
                (
                    self.usuarioLogado().perfil() === service.EPerfil.ADMINISTRADOR ||
                    self.usuarioLogado().perfil() === service.EPerfil.GESTOR ||
                    self.usuarioLogado().perfil() === service.EPerfil.USUARIO ||
                    self.usuarioLogado().perfil() === service.EPerfil.FUNCIONARIO
                ))
                return true;

            return false;
        });   

        self.exibeMenuGeoreferencia = ko.computed(function () {
            if (self.usuarioLogado() &&
                (
                    self.usuarioLogado().perfil() === service.EPerfil.ADMINISTRADOR ||
                    self.usuarioLogado().perfil() === service.EPerfil.GESTOR
                ))
                return true;

            return false;
        });   

        self.exibeMenuGestaoProjeto = ko.computed(function () {
            if (self.usuarioLogado() &&
                (
                    self.usuarioLogado().perfil() === service.EPerfil.ADMINISTRADOR ||
                    self.usuarioLogado().perfil() === service.EPerfil.GESTOR
                ))
                return true;

            return false;
        });   
       
        self.exibeMenuUsuario = ko.computed(function () {
            if (self.usuarioLogado() &&
                (
                    self.usuarioLogado().perfil() === service.EPerfil.ADMINISTRADOR 
                ))
                return true;

            return false;
        });

        
    };

    ko.applyBindings(viewModelMenu, binding);    
    return viewModelMenu;
}();